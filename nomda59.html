<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transformationstraining: Nominativ zu Dativ</title>
    <script src="https://cdn.jsdelivr.net/npm/drag-drop-touch@1.3.1/DragDropTouch.js"></script>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --success: #27ae60;
            --error: #e74c3c;
            --bg: #f4f7f6;
            --card: #ffffff;
        }

        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background-color: var(--bg);
            color: var(--primary);
            margin: 0;
            padding: 10px;
            display: flex;
            justify-content: center;
        }

        .container {
            width: 100%;
            max-width: 800px;
            background: var(--card);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        header {
            text-align: center;
            border-bottom: 3px solid var(--secondary);
            margin-bottom: 25px;
            padding-bottom: 10px;
        }

        .instruction {
            background: #eef2f7;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 25px;
            border-left: 5px solid var(--secondary);
            font-size: 0.95rem;
        }

        .exercise-card {
            background: #fff;
            border: 2px solid #eaeeef;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .nom-phrase {
            display: inline-block;
            background: #f8f9fa;
            padding: 5px 10px;
            border-radius: 4px;
            font-weight: bold;
            color: var(--secondary);
            margin-bottom: 15px;
        }

        .sentence-display {
            font-size: 1.1rem;
            margin-bottom: 20px;
            line-height: 2;
        }

        .drop-area {
            display: inline-flex;
            gap: 5px;
            min-width: 150px;
            min-height: 35px;
            border-bottom: 2px solid #bdc3c7;
            vertical-align: middle;
            padding: 0 10px;
        }

        .drop-area.correct { border-bottom-color: var(--success); color: var(--success); }
        .drop-area.incorrect { border-bottom-color: var(--error); color: var(--error); }

        .token-pool {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }

        .token {
            padding: 8px 15px;
            background: #ebf0f1;
            border: 1px solid #bdc3c7;
            border-radius: 6px;
            cursor: pointer;
            user-select: none;
            transition: all 0.2s;
            font-size: 0.95rem;
        }

        .token:hover { background: #dce4e6; }
        .token.selected { opacity: 0.3; cursor: default; }

        .btn-group {
            display: flex;
            gap: 10px;
        }

        button {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            font-size: 0.85rem;
            transition: opacity 0.2s;
        }

        .btn-reset { background: #95a5a6; color: white; }
        .btn-sol { background: var(--secondary); color: white; }

        @media (max-width: 600px) {
            .container { padding: 15px; }
            .sentence-display { font-size: 1rem; }
        }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>Russisch-Assistent</h1>
        <h2>Transformation: Nominativ ➔ Dativ</h2>
    </header>

    <div class="instruction">
        <strong>Ziel:</strong> Wandle die Wortgruppe im Nominativ passend zum Satz in den Dativ um. <br>
        <strong>Anleitung:</strong> Klicke auf die Wörter im grauen Bereich, um sie in den Satz einzusetzen. Klicke ein Wort im Satz an, um es wieder zu entfernen.
    </div>

    <div id="exercise-list"></div>
</div>

<script>
    const exercises = [
        { id: 1, nom: "молодой человек", sentence: "Катя помогает ...", ans: ["молодому", "человеку"], pool: ["молодому", "молодой", "молодое", "человеку", "человек", "человека"] },
        { id: 2, nom: "новый дом", sentence: "Он идёт к ...", ans: ["новому", "дому"], pool: ["новому", "новым", "новый", "дому", "дома", "дом"] },
        { id: 3, nom: "хорошая погода", sentence: "Мы рады ...", ans: ["хорошей", "погоде"], pool: ["хорошей", "хорошую", "хорошая", "погоде", "погоду", "погода"] },
        { id: 4, nom: "лучший друг", sentence: "Я звоню ...", ans: ["лучшему", "другу"], pool: ["лучшему", "лучшим", "лучший", "другу", "друга", "друг"] },
        { id: 5, nom: "синее здание", sentence: "Подойди к ...", ans: ["синему", "зданию"], pool: ["синему", "синее", "синим", "зданию", "здание", "здания"] },
        { id: 6, nom: "новая школа", sentence: "Она идёт к ...", ans: ["новой", "школе"], pool: ["новой", "новую", "новая", "школе", "школу", "школа"] },
        { id: 7, nom: "младшая сестра", sentence: "Я помогаю ...", ans: ["младшей", "сестре"], pool: ["младшей", "младшую", "младшая", "сестре", "сестру", "сестра"] },
        { id: 8, nom: "большое окно", sentence: "Он подошёл к ...", ans: ["большому", "окну"], pool: ["большому", "большое", "большим", "окну", "окно", "окна"] },
        { id: 9, nom: "интересная книга", sentence: "Мы рады этой ...", ans: ["интересной", "книге"], pool: ["интересной", "интересную", "интересная", "книге", "книгу", "книга"] },
        { id: 10, nom: "старый дедушка", sentence: "Мы едем к ...", ans: ["старому", "дедушке"], pool: ["старому", "старым", "старый", "дедушке", "дедушку", "дедушка"] },
        { id: 11, nom: "летнее солнце", sentence: "Мы рады ...", ans: ["летнему", "солнцу"], pool: ["летнему", "летнее", "летняя", "солнцу", "солнце", "солнца"] },
        { id: 12, nom: "любимая бабушка", sentence: "Она пишет ...", ans: ["любимой", "бабушке"], pool: ["любимой", "любимую", "любимая", "бабушке", "бабушку", "бабушка"] },
        { id: 13, nom: "высокий мужчина", sentence: "Помоги этому ...", ans: ["высокому", "мужчине"], pool: ["высокому", "высоким", "высокий", "мужчине", "мужчину", "мужчины"] },
        { id: 14, nom: "синяя больница", sentence: "Скорая едет к ...", ans: ["синей", "больнице"], pool: ["синей", "синюю", "синяя", "больнице", "больницу", "больница"] },
        { id: 15, nom: "дальний родственник", sentence: "Они звонят ...", ans: ["дальнему", "родственнику"], pool: ["дальнему", "дальнего", "дальний", "родственнику", "родственника", "родственник"] },
        { id: 16, nom: "другой банк", sentence: "Иди к ...", ans: ["другому", "банку"], pool: ["другому", "другой", "другое", "банку", "банка", "банк"] },
        { id: 17, nom: "строгая мама", sentence: "Она пишет ...", ans: ["строгой", "маме"], pool: ["строгой", "строгую", "строгая", "маме", "маму", "мама"] },
        { id: 18, nom: "соседний дом", sentence: "Мы подошли к ...", ans: ["соседнему", "дому"], pool: ["соседнему", "соседним", "соседний", "дому", "дома", "дом"] },
        { id: 19, nom: "умный ученик", sentence: "Учитель помогает ...", ans: ["умному", "ученику"], pool: ["умному", "умным", "умный", "ученику", "ученика", "ученик"] },
        { id: 20, nom: "добрая учительница", sentence: "Дети идут к ...", ans: ["доброй", "учительнице"], pool: ["доброй", "добрую", "добрая", "учительнице", "учительницу", "учительница"] }
    ];

    let userSelections = {};

    function shuffle(array) {
        return array.sort(() => Math.random() - 0.5);
    }

    function renderExercises() {
        const list = document.getElementById('exercise-list');
        list.innerHTML = '';
        
        exercises.forEach((ex) => {
            userSelections[ex.id] = [];
            const card = document.createElement('div');
            card.className = 'exercise-card';
            card.id = `ex-${ex.id}`;

            const poolShuffled = shuffle([...ex.pool]);

            card.innerHTML = `
                <div class="nom-phrase">Nominativ: ${ex.nom}</div>
                <div class="sentence-display">
                    ${ex.sentence} <span class="drop-area" id="drop-${ex.id}"></span>
                </div>
                <div class="token-pool" id="pool-${ex.id}">
                    ${poolShuffled.map(word => `<span class="token" onclick="selectToken(${ex.id}, this)">${word}</span>`).join('')}
                </div>
                <div class="btn-group">
                    <button class="btn-reset" onclick="resetExercise(${ex.id})">Zurücksetzen & Mischen</button>
                    <button class="btn-sol" onclick="showSolution(${ex.id})">Lösung anzeigen</button>
                </div>
            `;
            list.appendChild(card);
        });
    }

    window.selectToken = function(exId, el) {
        if (el.classList.contains('selected')) return;
        
        const selection = userSelections[exId];
        if (selection.length >= 2) return;

        el.classList.add('selected');
        selection.push(el.innerText);
        updateDisplay(exId);
    };

    function updateDisplay(exId) {
        const dropArea = document.getElementById(`drop-${exId}`);
        const selection = userSelections[exId];
        
        dropArea.innerHTML = selection.map((word, idx) => 
            `<span style="cursor:pointer" onclick="removeToken(${exId}, ${idx})">${word}</span>`
        ).join(' ');

        if (selection.length === 2) {
            checkAnswer(exId);
        } else {
            dropArea.className = 'drop-area';
        }
    }

    window.removeToken = function(exId, idx) {
        const word = userSelections[exId].splice(idx, 1)[0];
        const tokens = document.getElementById(`pool-${exId}`).querySelectorAll('.token');
        
        for (let t of tokens) {
            if (t.innerText === word && t.classList.contains('selected')) {
                t.classList.remove('selected');
                break;
            }
        }
        updateDisplay(exId);
    };

    function checkAnswer(exId) {
        const ex = exercises.find(e => e.id === exId);
        const dropArea = document.getElementById(`drop-${exId}`);
        const isCorrect = userSelections[exId].join(' ') === ex.ans.join(' ');

        if (isCorrect) {
            dropArea.classList.add('correct');
        } else {
            dropArea.classList.add('incorrect');
        }
    }

    window.resetExercise = function(exId) {
        userSelections[exId] = [];
        const ex = exercises.find(e => e.id === exId);
        const pool = document.getElementById(`pool-${exId}`);
        const dropArea = document.getElementById(`drop-${exId}`);
        
        dropArea.className = 'drop-area';
        dropArea.innerHTML = '';
        
        const shuffled = shuffle([...ex.pool]);
        pool.innerHTML = shuffled.map(word => `<span class="token" onclick="selectToken(${exId}, this)">${word}</span>`).join('');
    };

    window.showSolution = function(exId) {
        const ex = exercises.find(e => e.id === exId);
        const dropArea = document.getElementById(`drop-${exId}`);
        const tokens = document.getElementById(`pool-${exId}`).querySelectorAll('.token');
        
        userSelections[exId] = [...ex.ans];
        tokens.forEach(t => t.classList.remove('selected'));
        
        ex.ans.forEach(ansWord => {
            for (let t of tokens) {
                if (t.innerText === ansWord && !t.classList.contains('selected')) {
                    t.classList.add('selected');
                    break;
                }
            }
        });

        updateDisplay(exId);
        dropArea.classList.add('correct');
    };

    window.onload = renderExercises;
</script>

</body>
</html>